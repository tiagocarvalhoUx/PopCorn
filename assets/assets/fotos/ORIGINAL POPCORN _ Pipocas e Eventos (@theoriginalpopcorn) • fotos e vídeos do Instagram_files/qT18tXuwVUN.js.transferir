;/*FB_PKG_DELIM*/

__d("DoubleKeyMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.set=function(a,b,c){var d=this.$1.get(a);d||this.$1.set(a,d=new Map());d.set(b,c)};b.get=function(a,b){return(a=this.$1.get(a))==null?void 0:a.get(b)};b["delete"]=function(a,b){var c=this.$1.get(a);c&&(c["delete"](b),c.size===0&&this.$1["delete"](a))};b.getAll=function(a){return this.$1.get(a)};b.deleteAll=function(a){this.$1["delete"](a)};return a}();f.DoubleKeyMap=a}),66);
__d("EARInitType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["EB_INIT","LS_INIT","MAW_INIT","MAW_RP_INIT"]);c=a;f["default"]=c}),66);
__d("FuncChannel",["FBLogger","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){var d=this,e;this.$2=[];this.callMessageHandler=function(a){return new(h||(h=b("Promise")))(function(b,c){a.result={resolveFunc:b,rejectFunc:c},d.$2.push(a)})};this.messageToCall=function(a){var b,e,f=d.proxyMethods[a.method];if(typeof f!=="function"){c("FBLogger")("worker").mustfix("proxyMethods[%s] is not a functions",a.method);return}b=(b=a.result)==null?void 0:b.resolveFunc;e=(e=a.result)==null?void 0:e.rejectFunc;if(typeof b==="function"&&typeof e==="function")try{var g=f.apply(a.thisArg,a.argList);b(g)}catch(a){e(a)}else return f.apply(a.thisArg,a.argList)};var f=this,g={},i=(e=a==null?void 0:a(g))!=null?e:{},j=babelHelpers["extends"]({},g);function k(a){j[a]=function(){var b={type:"call",method:a,thisArg:null,argList:Array.from(arguments)};return f.callMessageHandler(b)},g[a]=function(){var b=f.$1[a];if(typeof b!=="function"){c("FBLogger")("worker").mustfix("_backend[%s] is not a functions",a);return}return b.apply(f.$1,arguments)},i[a]==null&&(i[a]=g[a])}this.$1=j;if(a!=null){e=Object.keys(i);e.forEach(k);this.proxyMethods=i}else this.proxyMethods=new Proxy(i,{get:function(a,b){a=b;i[a]==null&&k(a);return i[a]}})}var d=a.prototype;d.flushBuffer=function(){var a=this.$2;this.$2=[];a.forEach(this.messageToCall)};d.setBackend=function(a){this.$1!==a&&(this.$1=a,this.flushBuffer());return this};d.setCallMessageHandler=function(a){this.callMessageHandler=a,this.flushBuffer()};return a}();g["default"]=a}),98);
__d("MAWAppVersion",["SiteData"],(function(a,b,c,d,e,f,g){"use strict";function a(){return"302.0."+c("SiteData").client_revision}function b(){return{primary:302,secondary:0,tertiary:c("SiteData").client_revision}}g.getVersionNumber=a;g.getAppVersionParts=b}),98);
__d("MAWConsoleLogger",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("2656");function a(a,b,c){if(h){var d=c.map(function(a){return"["+a+"]"}).join("");for(var e=arguments.length,f=new Array(e>3?e-3:0),g=3;g<e;g++)f[g-3]=arguments[g];if(d){var i;(i=console)[a].apply(i,[d,b].concat(f))}else{var j;(j=console)[a].apply(j,[b].concat(f))}}}g.logToConsole=a}),98);
__d("MAWLogIndexedDb",["MAWCurrentUser","MAWErrorObject","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","err","justknobx","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=null;function k(){return c("justknobx")._("1399")}function l(){if(i==null)throw c("err")("LogDB IndexDB should've been initialized");return i}function m(){return j==null?o().then(function(){return l()}):j.then(function(){return l()})}function a(){return i!=null}var n=[function(a){a=a.target.transaction;d("WAExceededStorageQuota").listenToQuotaExceededError(a);a=a.db.createObjectStore("logs",{autoIncrement:!0,keyPath:"id"});a.createIndex("date","date",{unique:!1})}];function o(a){if(j!=null)return j;if(i!=null)return(h||(h=b("Promise"))).resolve();var c=d("MAWCurrentUser").getID(),e=d("MAWIndexedDbMetadata").logDbName(c),f=(a=(c=a)!=null?c:k())!=null?a:n.length;j=new(h||(h=b("Promise")))(function(a,b){var c=indexedDB.open(e,f);c.onupgradeneeded=function(a){for(var b=0;b<n.length;b++){var c=n[b];p(a,b+1)&&c(a)}};c.onsuccess=function(b){var c=b.target.result;c.onversionchange=function(){c.close()};i=c;a()};c.onerror=function(){b(c.error)}});return j}function p(a,b){var c=a.newVersion;a=a.oldVersion;return a<b&&c>=b}function q(a){return a===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function e(a,b,e){var f=q(b);return function(b){return function(){for(var g=arguments.length,h=new Array(g),i=0;i<g;i++)h[i]=arguments[i];var j=e!=null?d("MAWQplProxy").startQplUserFlow(e):null;return m().then(function(c){var e=function(b){b=c.transaction(a,b!=null?q(b):f,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(b);return b.objectStore(a)};return b.apply(void 0,[e].concat(h))}).then(function(a){j==null?void 0:j.endSuccess();return a})["catch"](function(a){j==null?void 0:j.endFail("transaction_fail");a=d("MAWErrorObject").getErrorObject(a);throw c("unrecoverableViolation")("LOG - Error performing transaction in log transactor","maw_db",a?{error:a}:{})})}}}g.getLogDbVersion=k;g.getLogDB=l;g.isLogDBInitted=a;g.dbMigrations=n;g.makeLogMsgrTransactor=e}),98);
__d("MAWSaveLogToDisk",["Deferred","MAWLogIndexedDb","MAWTransactionMode","Promise","asyncToGeneratorRuntime","justknobx","pageID","promiseDone","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("1403");f=c("justknobx")._("1404");var j=c("justknobx")._("1401");function k(a){if(Number.isInteger(a))return a;if(typeof a==="string")return(a||"").replace(/\n/g,"");try{return JSON.stringify(a)}catch(a){return"Data could not be serialized"}}function l(a,b){b===void 0&&(b="");return a.length>0?"["+a.join("|")+"]":b}function m(a){switch(a){case"logRestricted":return"warn";case"debug":case"log":case"warn":case"error":return a}}function a(a){return{args:a.logString,date:a.date,event:l(a.tags,"[]"),level:m(a.logLevel)}}function e(a,b,c,d,e,f){return{args:a+"; ERROR="+c.message+";",data:{entriesToReport:e,error:c,framesToPop:d,stack:f},date:Date.now(),event:l(b,"[]"),level:"error"}}var n=[],o=[],p=5,q=0,r=!1,s=function(){n.length=0},t=function(a){a=y(a);o.length<p?o.push(a):o[q%p]=a;q=(q+1)%p},u=function(a){var c=[],d=0;while(d<a){var e=((q-d-1)%p+p)%p;e=o[e];c.push(e);d++}return(h||(h=b("Promise"))).resolve(c)},v=function(a,b){n.push({context:a,logEntry:b}),t({context:a,logEntry:b}),n.length>i?c("promiseDone")(w()):x()},w=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){r=!0;try{var a=[].concat(n);s();yield z(a)}catch(a){}r=!1});return function(){return a.apply(this,arguments)}}(),x=c("throttle")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(r)return;r=!0;try{var a=[].concat(n);s();yield z(a)}catch(a){}r=!1}),f),y=function(a){var b=a.context;a=a.logEntry;return Object.entries(a).reduce(function(a,b){var c=b[0];b=b[1];a[c]=k(b);return a},babelHelpers["extends"]({},a,{category:b+"-"+c("pageID")}))},z=d("MAWLogIndexedDb").makeLogMsgrTransactor("logs",d("MAWTransactionMode").READWRITE)(function(a,b){var d=new(c("Deferred"))(),e=a();b.forEach(function(a){e.add(y(a))});e.transaction.oncomplete=function(){return d.resolve()};e.transaction.onerror=function(a){return d.reject(a)};return d.getPromise()});f=d("MAWLogIndexedDb").makeLogMsgrTransactor("logs",d("MAWTransactionMode").READONLY)(function(a){var b=new(c("Deferred"))();a=a();a=a.getAll();a.onsuccess=function(a){a=a.target.result;a=a.slice(Math.max(0,a.length-j));b.resolve(a)};a.onerror=function(a){return b.reject(a)};return b.getPromise()});var A=function(a){if(a<=o.length)return u(a);else return B(a)},B=d("MAWLogIndexedDb").makeLogMsgrTransactor("logs",d("MAWTransactionMode").READONLY)(function(a,b){var d=new(c("Deferred"))();a=a();a=a.index("date");a=a.openCursor(null,"prev");var e=[];a.onsuccess=function(a){a=a.target.result;if(a==null){d.resolve(e);return}e.push(a.value);if(e.length>=b){d.resolve(e);return}a["continue"]()};a.onerror=function(a){return d.reject(a)};return d.getPromise()});g.joinTags=l;g.formatLog=a;g.formatErrorForLogging=e;g.clearLogEntryCache=s;g.saveLogEntry=v;g.forceCachedLogEntryPersist=w;g.getEntries=f;g.getLastNEntries=A}),98);
__d("MAWDeleteOldLogsFromDisk",["Deferred","MAWLogIndexedDb","MAWSaveLogToDisk","MAWTransactionMode","WALogger","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete old logs: ",""]);j=function(){return a};return a}var k=c("justknobx")._("1400"),l=c("justknobx")._("1401"),m=c("justknobx")._("1402"),n=(f=d("MAWLogIndexedDb")).makeLogMsgrTransactor("logs",(h=d("MAWTransactionMode")).READONLY)(function(a){var b=new(c("Deferred"))();a=a();a=a.count();a.onsuccess=function(a){a=a.target.result;b.resolve(a)};a.onerror=function(a){b.reject(a)};return b.getPromise()}),o=f.makeLogMsgrTransactor("logs",h.READONLY)(function(a,b){var d=new(c("Deferred"))();a=a();var e=[];a=a.index("date");a=a.openCursor();a.onsuccess=function(a){a=a.target.result;if(a==null||!b(a.value,e)){d.resolve(e);return}e.push(a.value.id);a["continue"]()};a.onerror=function(a){d.reject(a)};return d.getPromise()}),p=f.makeLogMsgrTransactor("logs",h.READWRITE)(function(a){var b=new(c("Deferred"))();a=a();a=a.clear();a.onsuccess=function(){return b.resolve()};a.onerror=function(a){return b.reject(a)};d("MAWSaveLogToDisk").clearLogEntryCache();return b.getPromise()}),q=f.makeLogMsgrTransactor("logs",h.READWRITE)(function(a,b){var d=new(c("Deferred"))(),e=a();b.forEach(function(a){return e["delete"](a)});e.transaction.oncomplete=function(){return d.resolve()};e.transaction.onerror=function(a){return d.reject(a)};return d.getPromise()});function r(a,b){b=Date.now()-m;return a!=null&&a.date<=b}function s(a){return function(b,c){return c.length<a}}function a(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield n());if(a===0)return;a=a-l;if(a>0){a=(yield o(s(a)));yield q(a);return}a=(yield o(r));a.length>0&&(yield q(a))}catch(a){d("WALogger").ERROR(j(),a)}});return t.apply(this,arguments)}function e(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield n());if(a===0)return;if(a>=k){yield p();return}}catch(a){d("WALogger").ERROR(i(),a)}});return u.apply(this,arguments)}g.clearLogs=p;g.deleteOldLogs=a;g.deleteOldLogsOnStartup=e}),98);
__d("MAWEncryptedBackupsStateManager",["MAWEBSwitch","MAWEBUploadTrackingUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return;case 3:c("MAWEBSwitch").set(!0);return;case 2:case 4:default:c("MAWEBSwitch").set(!1);h();return}}function h(){d("MAWEBUploadTrackingUtils").getUploadQueueStartedCache().forEach(function(a,b,c){d("MAWEBUploadTrackingUtils").endSuccess(a,"upload_tracking_cancelled_eb_turned_off",{string:{externalId:b,from:"backup state turned off"}}),d("MAWEBUploadTrackingUtils").removeExternalIdFromUploadQueueStartedCache(b)})}function b(a){return a===4||a===3}g.setEncryptedBackupsState=a;g.eligibleForEBUX=b}),98);
__d("MAWEncyptionIndexedDbV2",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","IndexedDbPolyfills","MAWCurrentUser","MAWErrorObject","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","QPLUserFlow","WAExceededStorageQuota","WALogger","WAWorkerGlobalScope","err","gkx","qpl","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Armadillo Web Remote Presence] MAW RP Initialising EAR"]);j=function(){return a};return a}b("IndexedDbPolyfills");var k="browserEncryptionMetaV2",l="version",m=1,n=null,o=null,p=null;function q(){if(n==null)throw c("err")("Encryption IndexDB should've been initialized");return n}function a(){return n!=null}function r(a,e){e===void 0&&(e=0);var f=d("MAWCurrentUser").getID(),g=t(a);return new(i||(i=b("Promise")))(function(b,i){if(e>m){u(g,"ear_idb_retry_failed_max_reached");return i(c("err")("Failed to create encryption DB after max retries"))}var j="false",q="false",s="false",t="false";try{if(n==null){if(indexedDB==null){u(g,"ear_idb_unavailable");return i(c("err")("IndexedDB API not available"))}u(g,"ear_db_open_start",{bool:{browserLockEnabled:c("BrowserLockManager")!=null}});p=d("MAWIndexedDbMetadata").encryptionDbName(f);var v=indexedDB.open(p),w=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){i(c("err")("IndexedDB initialisation timeout in %s flow. In worker: %s. In shared worker: %s. onsuccess called: %s. onerror called: %s. onupgradeneeded called: %s. onblockedCalled: %s. openRequest: %s",String(a),(h||(h=c("ExecutionEnvironment"))).isInWorker?"true":"false",(h||(h=c("ExecutionEnvironment"))).isInSharedWorker?"true":"false",q,j,s,t,v.readyState))},1e4);v.onupgradeneeded=function(a){s="true";u(g,"ear_db_upgrade_start");a=a.target.result;if(!a.objectStoreNames.contains(k)){a=a.createObjectStore(k,{autoIncrement:!0,keyPath:"id"});a.createIndex(l,l,{unique:!0})}u(g,"ear_db_upgrade_end")};v.onblocked=function(){u(g,"ear_db_open_blocked"),t="true",d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){i(c("err")("EAR Open timed out while blocked"))},2e3)};v.onsuccess=function(f){var h=c("gkx")("4052");q="true";d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(w);var j=f.target.result;if(h&&!j.objectStoreNames.contains(k)){j.close();if(p==null){u(g,"ear_idb_retry_failed_missing_db");return i(c("err")("Attempting to delete encryption DB but _dbName is null"))}var l=indexedDB.deleteDatabase(p);l.onerror=function(){u(g,"ear_idb_retry_failed_delete_failed");return i(c("err")("Failed to delete malformed encryption DB: "+l.error.message))};l.onsuccess=function(){r(a,e+1).then(b)["catch"](i)};return}j.onversionchange=function(){j.close(),c("FBLogger")("maw_ear").info("EAR onversionchange triggered"),o==null?void 0:o()};u(g,"ear_db_open_end");n=j;b()};v.onerror=function(){j="true",u(g,"ear_db_open_error"),d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(w),i(v.error)}}else u(g,"ear_db_exists"),b()}catch(a){u(g,"ear_db_error"),i(a)}})}function e(a){o=o==null?a:o}function f(a){var b=d("MAWTransactionMode").READWRITE===a?"readwrite":"readonly";a=function(a){return function(){var e=q(),f=e.transaction(k,b);d("WAExceededStorageQuota").listenToQuotaExceededError(f);var g=f.objectStore(k);for(var h=arguments.length,i=new Array(h),j=0;j<h;j++)i[j]=arguments[j];return a.apply(void 0,[g].concat(i))["catch"](function(a){a=d("MAWErrorObject").getErrorObject(a);throw c("unrecoverableViolation")("Error performing transaction in encryption transactor v2","maw_db",a?{error:a}:{})})}};return a}function s(){n!=null&&n.close();return d("MAWIndexedDBDeletion").deleteDB(p,"ear")}function t(a){switch(a){case c("EARInitType").EB_INIT:return c("qpl")._(521477507,"1406");case c("EARInitType").MAW_INIT:return c("qpl")._(25310776,"6155");case c("EARInitType").MAW_RP_INIT:d("WALogger").DEV(j());return c("qpl")._(25310776,"6155");case c("EARInitType").LS_INIT:return c("qpl")._(25305590,"1127")}}function u(a,b,e){(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(a,"worker_"+b,{annotations:e}):(c("QPLUserFlow").addPoint(a,b),e!=null&&c("QPLUserFlow").addAnnotations(a,e))}g.storeName=k;g.ENCRYPTION_MAW_STORES_INDEX=l;g.getEncryptionDB=q;g.isEncryptionDBInited=a;g.makeEncryptionDB=r;g.maybeSetEncryptionDbOnVersionChange=e;g.makeEncryptionMsgrTransactor=f;g.deleteEncryptionDB=s}),98);
__d("WAFixedSizeMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=new Map();this.$3=0;this.$4=100;this.$4=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1.set(a,b);this.$2.set(this.$3,a);this.$3+=1;b=this.$2.get(this.$3-this.$4-1);b!=null&&(this.$1["delete"](b),this.$2["delete"](this.$3-this.$4-1))};b.clear=function(){this.$1.clear(),this.$2.clear(),this.$3=0};b.size=function(){return this.$1.size};return a}();f.FixedSizeMap=a}),66);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WAFixedSizeMap","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=b,a.onerror=c})}function j(a){return i(a).then(function(a){return a.target.result})}function k(a,c,e){return new(h||(h=b("Promise")))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var l=new(d("WAFixedSizeMap").FixedSizeMap)({max:100});function a(a,c){var e,f=c.args,g=c.scheduleConfig,i=c.type,l=c.uniqKey;c=c.version;c=c===void 0?1:c;e=JSON.stringify([i,(e=l)!=null?e:d("WAHex").randomHex(32)]);var n={backedOffCount:0,current:f,original:f,scheduleConfig:g,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:i,uniqKey:e,version:c,waitUntil:null},o=function(){var b,c=a().add(n),d=j(c);if(n.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(l!=null)return k(a,"uniqKey",e).then(function(c){if(c.length===0)return o();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(m(a,b.jobId))});return(h||(h=b("Promise"))).all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:o()})});else return o()}function m(a,b){return j(a()["delete"](b))}function c(a,b){return j(a().get(b))}function e(a,b){return j(a().put(b))}function f(a){return j(a().getAll())}function n(a){try{return i(a().clear()).then(function(){})}catch(a){if(a.name==="NotFoundError")return(h||(h=b("Promise"))).resolve();throw a}}g.recentFinishedJobsCache=l;g.maybeCreateJob=a;g.deletePersistedJob=m;g.readPersistedJob=c;g.updatePersistedJob=e;g.readAllPersistedJobs=f;g.clearJobs=n}),98);
__d("MWEARKeychainV3",["ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWEncyptionIndexedDbV2","MAWGenKeychainCryptoKeyWithVersion","MAWKeychainCrypto","MAWWebInitDataHelpers","MWEARKeychainV3Errors","MessengerWebInitData","Promise","ReStoreTabNotifier","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","err","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={accountKey:null,databaseEncryptionKeys:new Map(),latestVersion:d("MAWCryptoConsts").VERSION},k=babelHelpers["extends"]({},j);function a(){k=babelHelpers["extends"]({},j,{databaseEncryptionKeys:new Map()})}var l="browserEncryptionMetaV2";function e(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("MAWCurrentUser").getID(),e=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+a);e==null?void 0:e.onEventReceive("notifyEarKeychain",v);d("LSPlatformLsInitLog").addPoint("ear_init_start");try{d("LSPlatformLsInitLog").addPoint("ear_fetch_start");var f=(yield q(s("readonly")));d("LSPlatformLsInitLog").addPoint("ear_fetch_end");if(p(f)){d("LSPlatformLsInitLog").addPoint("ear_gen_key_start");var g=(yield c("MAWEARGenNewKeychainCryptoKey")());yield new(i||(i=b("Promise")))(function(a,b){var c=s("readwrite"),d=c.objectStore(l).getAll();d.onerror=function(){return b(d.error)};d.onsuccess=function(){var h;f=r(d.result);h=(h=(h=f[f.length-1])==null?void 0:h.version)!=null?h:0;if(!p(f))return a();var i=babelHelpers["extends"]({},g,{version:h+1});c.oncomplete=function(){f.push(babelHelpers["extends"]({},i,{id:i.version})),e.postMessage("notifyEarKeychain",i.version),a()};var j=c.objectStore(l).put(i);j.onerror=function(){return b(j.error)}}})["catch"](function(a){throw c("FBLogger")("messenger_web_devx").catching(a).mustfixThrow("Failed to rotate EAR key")});d("LSPlatformLsInitLog").addPoint("ear_gen_key_end")}d("LSPlatformLsInitLog").addPoint("ear_import_start");a=(yield (i||(i=b("Promise"))).all(f.map(function(a){return o(a).then(function(b){(a.accountKeyString==null||a.userKeyBaseString==null||a.appIdOrigin==null||a.formatVersion==null)&&(d("LSPlatformLsInitLog").addPoint("ear_import_entry_backfill"),c("promiseDone")(w(a)));return b})})));d("LSPlatformLsInitLog").addPoint("ear_import_end");for(a of a)k.databaseEncryptionKeys.set(a.version,a.key);u();d("LSPlatformLsInitLog").addPoint("ear_init_end");return d("WAResultOrError").makeResult(n())}catch(a){d("LSPlatformLsInitLog").addPoint("ear_init_error");d("LSPlatformLsInitLog").addPoint("ear_init_end");c("FBLogger")("messenger_web_devx").catching(c("getErrorSafe")(a)).mustfix("Failed to setup EAR Keychain V3");return d("WAResultOrError").makeError("keychain-setup-failure",a)}});return m.apply(this,arguments)}function n(){return k.latestVersion}function f(a){a===void 0&&(a=n());var b=k.databaseEncryptionKeys.get(a);if(b==null){c("promiseDone")(q(s("readonly")).then(function(b){var d=b.map(function(a){return a.version}).includes(a);c("FBLogger")("messenger_web_devx").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",d,a,b.length)}));throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+a+" was null. Latest version: "+n())}return{key:b,version:a}}function o(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}function p(a){return a.length===0||!d("WATimeUtils").isInFuture(a[a.length-1].expiration)}function q(a){return t(a.objectStore(l).getAll()).then(r)}function r(a){return a.sort(function(a,b){return a.version-b.version})}function s(a){var b=d("MAWEncyptionIndexedDbV2").getEncryptionDB();return b.transaction(l,a,{durability:"relaxed"})}function t(a){return new(i||(i=b("Promise")))(function(b,c){a.onsuccess=function(){return b(a.result)},a.onerror=function(){return c(a.error)}})}var u=function(){var a=Array.from(k.databaseEncryptionKeys.keys());a.length>0&&(k.latestVersion=Math.max.apply(Math,a))},v=function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield q(s("readonly"))).find(function(b){return b.version===a});if(b==null)throw c("err")("Notified new Ear Key but missing in DB");b=(yield o(b));k.databaseEncryptionKeys.set(b.version,b.key);u()}catch(a){return c("FBLogger")("messenger_web_devx").catching(a).mustfix("Failed to handleNewVersion. In worker %s. In shared worker %s",(h||(h=c("ExecutionEnvironment"))).isInWorker?"true":"false",(h||(h=c("ExecutionEnvironment"))).isInSharedWorker?"true":"false")}})())},w=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=a.formatVersion)!=null?b:1;var e=(yield d("MAWKeychainCrypto").generateHashString(d("MAWWebInitDataHelpers").getAccountKeyString(b))),f=(yield d("MAWKeychainCrypto").generateHashString(c("MessengerWebInitData").userKeyBase)),g=s("readwrite");g.objectStore(l).put(babelHelpers["extends"]({},a,{accountKeyString:e,appIdOrigin:c("MessengerWebInitData").appId,formatVersion:b,userKeyBaseString:f}))});return function(b){return a.apply(this,arguments)}}();g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.init=e;g.getLatestVersion=n;g.getDbEncryptionKey=f}),98);
__d("MAWKeychain",["MWEARKeychainV3"],(function(a,b,c,d,e,f,g){"use strict";a={getDbEncryptionKey:d("MWEARKeychainV3").getDbEncryptionKey,getLatestVersion:d("MWEARKeychainV3").getLatestVersion,init:d("MWEARKeychainV3").init};g["default"]=a}),98);
__d("MAWLeakDetection",[],(function(a,b,c,d,e,f){"use strict";var g="[Vault] Vaulted string detected";function h(a){var b=/\d{10}##\d{10}/gm;return b.test(a)}function a(a){return h(a)?g:a}f.VAULTED_STRING_DETECTED=g;f.detectVaultedString=h;f.maybeReplaceVaultedString=a}),66);
__d("MAWLoggingSwitches",["gkx"],(function(a,b,c,d,e,f,g){"use strict";a=c("gkx")("503");g.removeLoggingFromBridge=a}),98);
__d("MAWUpdateClientRestoreStatusOperationType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;f.upsertClientRestoreStatus=a;f.markCompleteClientRestoreStatus=b}),66);
__d("MWSetupDBEncryption",["BrowserLockManager","FBLogger","MAWEncyptionIndexedDbV2","MAWKeychain","Promise","asyncToGeneratorRuntime","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return b()};function a(a){i=a}var j="mw_ear_db";function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("MAWEncyptionIndexedDbV2").makeEncryptionDB(a)}catch(a){a instanceof Error?c("FBLogger")("messenger_web_devx").catching(a).warn("Can not create encryption db with error"):c("FBLogger")("messenger_web_devx").warn("IndexedDB onerror when opening db");return{error:"keychain-setup-failure",payload:a,success:!1}}try{a=(yield i("init_setup_keychain",function(){return c("MAWKeychain").init()}));return a}catch(a){c("FBLogger")("messenger_web_devx").catching(c("getErrorSafe")(a)).warn("Error initializing EAR with error");return{error:"keychain-setup-failure",payload:a,success:!1}}});return l.apply(this,arguments)}function m(a){if(c("BrowserLockManager")!=null)return new(h||(h=b("Promise")))(function(d,e){c("promiseDone")(c("BrowserLockManager").request(j,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield k(a));d(b)}catch(a){e(a)}})),function(a){},function(a){c("FBLogger")("maw_db").catching(a).warn("[eardb] lock issue"),e(a)})});else return k(a)}function e(a,c){c===void 0&&(c=function(a){return!0});var d=null;return function(e){d==null&&(d=a(e).then(function(a){d=c(a)?(h||(h=b("Promise"))).resolve(a):null;return a})["catch"](function(a){d=null;throw a}));return d}}f=e(function(a){return m(a)},function(a){return(a==null?void 0:a.success)===!0});g.setPerformanceMeasurementTool=a;g.init=f}),98);
__d("MainPageUrl",["ExecutionEnvironment","FBLogger","SimpleHook"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new URL("http://undefined"),j=new(d("SimpleHook").SimpleHook)();function k(){var a;return(h||(h=c("ExecutionEnvironment"))).isInBrowser&&(i==null?void 0:(a=i.searchParams)==null?void 0:a.get("workerlog"))==="debug"}function a(a){try{k()&&c("FBLogger")("worker").debug("received url "+a);var b=new URL(a,i.href||"http://undefined");i.href!==b.href?(i.href=b.href,j.call(i)):k()&&c("FBLogger")("worker").debug("ignoring url: path didn't change in "+a)}catch(a){c("FBLogger")("worker").catching(a).warn("invalid url")}}typeof window==="object"&&typeof window.location==="object"&&typeof window.location.href==="string"&&a(window.location.href);g.mainPageUrl=i;g.onMainPageUrlChange=j;g.isWorkerLogEnabled=k;g.updateMainPageUrl=a}),98);
__d("NestedTimeRange",["SimpleHook","performance","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new(d("SimpleHook").SimpleHook)(),k=new(d("SimpleHook").SimpleHook)(),l="/";function m(a,b){return""+a+l+b}b=function(){function a(a,b){b===void 0&&(b=null),this.$3=0,this.$1=a,this.$2=b}var b=a.prototype;b.isRunning=function(){return this.$3>0};b.fullname=function(){return this.$2!==null?m(this.$2.fullname(),this.$1):this.$1};b.start=function(a){a===void 0&&(a=(h||(h=c("performanceAbsoluteNow")))());if(this.$3===0){var b;(b=this.$2)==null?void 0:b.start(a);this.__onStart(a)}++this.$3;return a};b.__onStart=function(a){j.call(this,a)};b.stop=function(a){a===void 0&&(a=(h||(h=c("performanceAbsoluteNow")))());--this.$3;if(this.$3===0){var b;this.__onStop(a);(b=this.$2)==null?void 0:b.stop(a)}return a};b.__onStop=function(a){k.call(this,a)};return a}();function a(){(i||(i=c("performance"))).mark&&(i||(i=c("performance"))).measure&&(j.add(function(a,b){(i||(i=c("performance"))).mark(a.fullname()+"_start")}),k.add(function(a,b){(i||(i=c("performance"))).measure(a.fullname(),a.fullname()+"_start")}))}g.OnRangeStart=j;g.OnRangeStop=k;g.TIME_RANGE_LEVEL_SEPARATOR=l;g.rangeFullName=m;g.NestedTimeRange=b;g.enableDevConsoleTimeline=a}),98);
__d("QLogEvent",["DoubleKeyMap","FBLogger","NestedTimeRange","QPLEvent","SimpleHook","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("DoubleKeyMap").DoubleKeyMap)(),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d){a=b.call(this,a,d)||this;a.$QPLRange$p_1=c;i.set(c,a.fullname(),babelHelpers.assertThisInitialized(a));return a}var e=a.prototype;e.__onStart=function(a){b.prototype.__onStart.call(this,a),this.$QPLRange$p_1.point(this.fullname()+"_START",{timestamp:a})};e.__onStop=function(a){b.prototype.__onStop.call(this,a),this.$QPLRange$p_1.point(this.fullname()+"_END",{timestamp:a}),i["delete"](this.$QPLRange$p_1,this.fullname())};e.range=function(b){this.fullname().startsWith(d("NestedTimeRange").TIME_RANGE_LEVEL_SEPARATOR)||c("FBLogger")("qpl").warn("Range %s cannot have subrange since root name does not start with /",this.fullname());var e=d("NestedTimeRange").rangeFullName(this.fullname(),b);return(e=i.get(this.$QPLRange$p_1,e))!=null?e:new a(b,this.$QPLRange$p_1,this)};return a}(d("NestedTimeRange").NestedTimeRange),k=new(d("DoubleKeyMap").DoubleKeyMap)(),l=new((b=d("SimpleHook")).SimpleHook)(),m=new b.SimpleHook(),n=new b.SimpleHook(),o=new b.SimpleHook(),p=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,e,f,g){var i;c===void 0&&(c=0);e===void 0&&(e=2);f===void 0&&(f=!1);var j=(h||(h=d("QPLEvent"))).getMarkerId(a);i=b.call(this,"event_"+j)||this;i.event=a;i.instanceKey=c;i.$QPLEvent$p_1=e;i.isUserFlow=f;i.$QPLEvent$p_2=g;k.set(j,c,babelHelpers.assertThisInitialized(i));return i}var e=a.prototype;e.action=function(a){this.$QPLEvent$p_1=a;return this};e.getAction=function(){return this.$QPLEvent$p_1};e.setIsUserFlow=function(a){this.isUserFlow=a;return this};e.startFromNavStart=function(){this.start(c("performanceNavigationStart")());return this};e.startFromTime=function(a){this.start(a);return this};e.__onStart=function(a){var b;(b=this.$QPLEvent$p_2)==null?void 0:b.onStart(this,a);l.call(this,a)};e.__onStop=function(a){var b;(b=this.$QPLEvent$p_2)==null?void 0:b.onStop(this,a);m.call(this,a);i.deleteAll(this);k["delete"]((h||(h=d("QPLEvent"))).getMarkerId(this.event),this.instanceKey)};e.range=function(a){var b;return(b=i.get(this,a))!=null?b:new j(a,this)};e.point=function(a,b){var c;b===void 0&&(b={});(c=this.$QPLEvent$p_2)==null?void 0:c.onPoint(this,a,b);n.call(this,a,b);return this};e.annotate=function(a){var b;(b=this.$QPLEvent$p_2)==null?void 0:b.onAnnotate(this,a);o.call(this,a);return this};return a}(d("NestedTimeRange").NestedTimeRange);function a(a,b,c){var e;b===void 0&&(b=0);return(e=k.get((h||(h=d("QPLEvent"))).getMarkerId(a),b))!=null?e:new p(a,b,2,!1,c)}g.OnEventStart=l;g.OnEventStop=m;g.OnEventPoint=n;g.OnEventAnnotate=o;g.QPLEvent=p;g.event=a}),98);
__d("SharedWorkerStatusLock",[],(function(a,b,c,d,e,f){"use strict";var g="sw-lock";function h(a){return g+"-"+a}function a(){var a=null,b;function c(){var c=self,d=c.navigator.locks;c.LockManager!=null&&d instanceof c.LockManager&&(b==null&&(b=new c.Promise(function(b){a=b})),d.request(h(c.name),function(a){if(a!=null)return b}))}function d(){a==null?void 0:a(),b=null,a=null}return{init:c,release:d}}f.getStatusLockName=h;f.getStatusLock=a}),66);
__d("TimedOnceFunc",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){var h;a=function(){function a(a,b){this.$2=!1,this.$4=a,this.$3=b,(h||(h=c("ExecutionEnvironment"))).isInBrowser&&this.$5()}var b=a.prototype;b.$6=function(){this.$1!=null&&clearTimeout(this.$1),this.$1=null};b.$5=function(){var a=this;this.isDone()||(this.$6(),this.$1=setTimeout(function(){a.$2=!0,a.run()},this.$3))};b.isDone=function(){return this.$4===null};b.isCancelled=function(){return this.$1===null&&this.$4!==null};b.run=function(){this.$6();if(this.$4!=null){var a=this.$4;this.$4=null;a(this.$2)}};b.getDelay=function(){return this.$3};b.delay=function(a){this.$3=(a=a)!=null?a:this.$3;this.$5()};b.cancel=function(){this.$6()};return a}();g.TimedOnceFunc=a}),98);
__d("VirtualMessageChannel",["invariant","Promise","SimpleHook","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=function(){function a(a){a===void 0&&(a=!1),this.$2=new(d("SimpleHook").SimpleHook)(),this.onmessage=null,this.onmessageerror=null,this.$3=a}var e=a.prototype;e.setRemotePort=function(a){this.$1=a};e.addEventListener=function(a,b,c){(a==="message"||a==="error")&&c==null||h(0,55320,a);if(a==="message")if(typeof b==="function")this.$2.add(b);else{c=b.handleEvent.bind(b);this.$2.add(c);b.__handler=c}};e.removeEventListener=function(a,b,c){if(typeof b==="function")this.$2.remove(b);else{a=b.__handler;this.$2.remove(a)}};e.postMessage=function(a,d){var e=this,f=function(){var b=c("nullthrows")(e.$1,"By now remote port must have value!");b.$2.call({data:a,ports:d})};this.$3?f():c("promiseDone")((i||(i=b("Promise"))).resolve(),f)};e.start=function(){};return a}();a=function(a,b){this.port1=new j(a),this.port2=new j(b),this.port1.setRemotePort(this.port2),this.port2.setRemotePort(this.port1)};g.VirtualMessagePort=j;g.VirtualMessageChannel=a}),98);
__d("WABridgeBatcher",["WAShiftTimer"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=1e3;a=function(){function a(a,b){var c=this;this.$1=null;this.$4=h;this.$5=Date.now();this.$6=new(d("WAShiftTimer").ShiftTimer)(function(){var a=c.$1;if(a==null)return;c.$1=null;c.$2(a)});this.$2=b;this.$3=a}var b=a.prototype;b.addEvent=function(a){var b=this.$1;this.$1=b?this.$3(b,a):[a];if(this.$6.isScheduled())return;b=this.$4;if(b<1){a=Date.now();var c=Math.max(a-this.$5,0)/i;b=Math.min(b+c,h);this.$4=b;this.$5=a}b>=1?(c=0,this.$4=b-1):(c=Math.ceil(i*(1-b)),this.$4=0);this.$6.onOrBefore(c)};b.cancel=function(){this.$1=null,this.$6.cancel()};return a}();g.BridgeBatcher=a}),98);
__d("WACrossWorkerPortal",["Promise","WABridgeBatcher","WAErr","WALogger","WAPromiseManagement"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["absorbPortal: transferring request #",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected non-result to call"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected result to cast: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unrecognized result ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," response of ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," request for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge queuing "," msgs"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge sending "," across (delayed)"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge received msg on old port"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge updating port"]);r=function(){return a};return a}var s=function(){function a(a,b,c,e){var f=this;this.port=null;this.$2=1;this.openRequests=new Map();this.listeners=new Set();this.processedRequests=new Set();this.$1=a;this.sendStream=new(d("WABridgeBatcher").BridgeBatcher)(b,function(a){f.$3(a)});c.forEach(function(b){a.setNamespaceHandler(b,f.$4(b))});this.clientId=e}var e=a.prototype;e.$5=function(){var a=this.clientId!=null?this.clientId+"_":"";return""+a+this.$2++};e.$6=function(a){a=a.split("_");return a.length!==2?null:a[0]};e.addListener=function(a){var b=this;this.listeners.add(a);return function(){return b.listeners["delete"](a)}};e.setPort=function(a){var b=this;d("WALogger").LOG(r());this.port=a;this.sendStream.cancel();a.onmessage=function(c){if(b.port!==a){d("WALogger").WARN(q()).devConsole(c.data);return}c=c.data;if(!c||!Array.isArray(c))return;c.forEach(function(c){b.$7(c,"incoming"),b.$8(a,c)})};this.openRequests.forEach(function(a){a=a.request;d("WALogger").DEV(p(),a.name);b.sendStream.addEvent({type:"request",content:a})})};e.getBridge=function(){return this.$1};e.$4=function(a){var b=this;return function(c,d,e,f){b.$9(a,c,d,e,f)}};e.$9=function(a,b,c,d,e){var f=this.$5();a={requestId:f,expectsResponse:!!d,namespace:a,name:b,arg:c,silentLog:e};this.openRequests.set(f,{request:a,resolver:d});this.sendStream.addEvent({type:"request",content:a})};e.$10=function(a,b){if(a!==this.port)return;this.sendStream.addEvent({type:"result",content:b})};e.$3=function(a){var b=this,c=this.port;if(!c){d("WALogger").DEV(o(),a.length);return}c.postMessage(a);a.forEach(function(a){return b.$7(a,"outgoing")})};e.$7=function(a,b){this.listeners.forEach(function(c){return c(a,b)})};e.$8=function(a,e){var f=this;if(e.type==="request"){var g=e.content,i=g.namespace,o=g.name,p=g.requestId,q=g.arg,r=g.expectsResponse,s=g.silentLog;s||d("WALogger").LOG(n(),p,o);g=this.$1;if(r){r=g.sendAndReceive(i,o,q,s).then(function(b){f.$10(a,{requestId:p,type:"success",result:b,silentLog:s})},function(b){f.$10(a,{requestId:p,type:"error",result:String(b),silentLog:s})});d("WAPromiseManagement").preventGarbageCollection(r)}else{g.fireAndForget(i,o,q,s);r={type:"result",content:{requestId:p,type:"handled",silentLog:s}};this.$7(r,"outgoing");a.postMessage([r])}}else{e.type;g=e.content;i=g.requestId;o=g.type;q=g.result;r=g.silentLog;r||d("WALogger").DEV(m(),i,o);e=this.$6(i);if(e!==this.clientId||this.processedRequests.has(i))return;g=this.openRequests.get(i);if(!g){d("WALogger").WARN(l(),i);return}switch(o){case"success":case"error":this.openRequests["delete"](i);this.processedRequests.add(i);r=g.resolver;r?r(o==="success"?q:(h||(h=b("Promise"))).reject(c("WAErr")(q))):d("WALogger").ERROR(k(),q);break;case"handled":g.resolver?d("WALogger").ERROR(j()):(this.openRequests["delete"](i),this.processedRequests.add(i));break}}};return a}();function a(a,b,c,d){return new s(a,c,b,d)}function e(a){var b;(b=a.port)==null?void 0:b.close();a.port=null;a.sendStream.cancel();b=a.openRequests;a.openRequests=new Map();var c=a.getBridge();b.forEach(function(a){var b=a.request;a=a.resolver;var e=b.namespace,f=b.name,g=b.arg,h=b.silentLog;d("WALogger").LOG(i(),b.requestId);a?a(c.sendAndReceive(e,f,g,h)):c.fireAndForget(e,f,g,h)})}g.CrossWorkerPortal=s;g.attachPortal=a;g.killPortalAndSendPendingToBridge=e}),98);
__d("WADevToolsBridge",["WADynamicRouterAsync"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WADynamicRouterAsync").DynamicRouter)();function a(){return h}g.getDevToolBridge=a}),98);
__d("WAPromiseTimeout",["Promise","WACustomError"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e){var f=null,g=new(h||(h=b("Promise")))(function(a,b){f=setTimeout(function(){b(new(d("WACustomError").TimeoutError)(e)),clearTimeout(f)},c)});return h.race([a,g])["finally"](function(){clearTimeout(f)})};g.promiseTimeout=a}),98);
__d("WorkerMessagePortLogging",["MainPageUrl","QLogEvent","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=Math.random()<.1,i=20,j=100,k=50;function a(){return d("MainPageUrl").isWorkerLogEnabled()||d("MainPageUrl").mainPageUrl.searchParams.get("worker_log")===1}var l=0;function m(){return d("QLogEvent").event(c("qpl")._(41497718,"106"),l++)}function b(a,b,c){c===void 0&&(c=!1);if(b==null||!h)return;var d=b.sendDelayHighPrecision,e=b.sendTimestamp,f=b.sendDateTime,g=b.receiveTimestamp,l=b.receiveDateTime,n=m();n.startFromTime();var o=n.range("SEND_DELAY");o.start(e);o.stop(g);o=n.range("SEND_DELAY_LOW_PRECISION");o.start(f);o.stop(l);o=Math.abs(e-f);e=Math.abs(g-l);n.annotate({string:{port_name:a},"int":{send_delay:d,send_drift:o,receive_drift:e},bool:{send_delay_above_max:d!=null&&d>i,send_drift_above_max:o>j,receive_drift_above_max:e>j}});if(c){f=n.range("ROUND_TRIP");f.start(b.sendTimestamp);f.stop(b.receiveTimestamp);g=b.receiveTimestamp-b.sendTimestamp;n.annotate({"int":{round_trip:g},bool:{round_trip_above_max:g>k}})}n.stop()}g.isWorkerLogEnabled=a;g.logMessageTiming=b}),98);
__d("WorkerMessagePort",["Deferred","FBLogger","MainPageUrl","Promise","PromiseAnnotate","SimpleHook","VirtualMessageChannel","WorkerMessagePortLogging","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){return a}var l=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("SimpleHook").SimpleHook);function m(a,b){a=k(a);a.__timing=b}function n(a){return a.__timing}a=function(){var a=e.prototype;a.onMessageHandler=function(a){try{this.onMessage.call(a);var b=this.$1[a.type];!b?this.onUnhandledMessage.call(a):b.call(a)}catch(a){this.onError.call(a)}};function e(a,b){var e=this;this.$1={};this.onUnhandledMessage=new l();this.onMessage=new l();this.onPostMessage=new l();this.onError=new l();this.$2=a;this.name=b;this.$2.addEventListener("message",function(a){return e.onMessageHandler(k(a.data))});this.$2.addEventListener("error",function(a){return e.onError.call(a)});this.onPostMessage.add(function(a){m(a,{receiveDateTime:-1,receiveTimestamp:-1,sendDateTime:Date.now(),sendDelayHighPrecision:0,sendDelayLowPrecision:0,sendTimestamp:(j||(j=c("performanceAbsoluteNow")))()})});this.onMessage.add(function(a){a=n(a);if(a!=null){var b=a.sendDateTime,f=a.sendTimestamp,g=(j||(j=c("performanceAbsoluteNow")))(),h=Date.now();a.receiveTimestamp=g;a.receiveDateTime=h;a.sendDelayHighPrecision=g-f;a.sendDelayLowPrecision=h-b;d("WorkerMessagePortLogging").logMessageTiming(e.name,a)}})}a.postMessage=function(a,b){this.onPostMessage.call(a),b?this.$2.postMessage(a,b):this.$2.postMessage(a)};a.addMessageListener=function(a,b){var c=this.$1[a];c||(c=new l(),this.$1[a]=c);return c.add(b)};a.removeMessageListener=function(a,b){a=this.$1[a];return!!a&&a.remove(b)};a.onMessageOnce=function(a,c){var d=this;return new(i||(i=b("Promise")))(function(b){var e=d.addMessageListener(a,function(f){c(f)&&(d.removeMessageListener(a,e),b(f))})})};a.close=function(){if(this.$2 instanceof MessagePort)this.$2.close();else if(this.$2 instanceof Worker)this.$2.terminate();else if(this.$2 instanceof DedicatedWorkerGlobalScope)this.$2.close();else{var a;(a=(a=this.$2.close)!=null?a:this.$2.terminate)==null?void 0:a.call(this.$2)}};a.isWrappingVirtualMessagePort=function(){return this.$2 instanceof d("VirtualMessageChannel").VirtualMessagePort};return e}();function o(a){return k(a)}e=function(a){babelHelpers.inheritsLoose(e,a);function e(e,f){var g;g=a.call(this,e,f)||this;var j=o(babelHelpers.assertThisInitialized(g)),k=new(c("Deferred"))();e=k.getPromise();j.addMessageListener("endpoint_started",function(a){k.resolve(a);var b=n(a);j.postMessage({endpoint:a.endpoint,startSendTimestamp:b==null?void 0:b.sendTimestamp,targetEndpoint:g.name,type:"endpoint_started_received"})});f=j.onMessageOnce("endpoint_started_received",function(){return!0});void (h||(h=d("PromiseAnnotate"))).setDisplayName(e,"endpoint_started");void h.setDisplayName(f,"endpoint_started_received");j.postMessage({endpoint:g.name,type:"endpoint_started"});c("promiseDone")(e,function(a){a=n(a);d("WorkerMessagePortLogging").logMessageTiming(g.name,a)});c("promiseDone")(f,function(a){a=n(a);a!=null&&d("WorkerMessagePortLogging").logMessageTiming(g.name,a,!0)});g.fullyConnected=(i||(i=b("Promise"))).race([e,f]).then(function(){return babelHelpers.assertThisInitialized(g)});return g}return e}(a);g.getMessageTiming=n;g.WorkerMessagePort=a;g.CastWorkerMessagePort=o;g.WorkerSyncedMessagePort=e}),98);
__d("WorkerFuncChannel",["invariant","DateConsts","ExecutionEnvironment","FBLogger","FuncChannel","MainPageUrl","Promise","TimedOnceFunc","VirtualMessageChannel","WorkerMessagePort","err","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k={serialize:function(a,b){b.push(a);return a},deserialize:function(a){return a}},l=1e4,m=0,n=5,o=n+1,p=function(){function a(a){var b=self.WeakRef;b&&(this.$1=new b(a))}var b=a.prototype;b.isDead=function(){return this.$1!=null&&this.$1.deref()==null};return a}(),q=function(e){babelHelpers.inheritsLoose(a,e);function a(a,b,f,g){var i;f===void 0&&(f=null);g===void 0&&(g={});i=e.call(this,a)||this;i.$WorkerFuncChannel1=new Map();i.$WorkerFuncChannel2=new Map();i.$WorkerFuncChannel5={"function":{serialize:function(a,b){b=o++;i.$WorkerFuncChannel1.set(b,a);a={type:"function",value:b};return a},deserialize:function(a){var b=babelHelpers.assertThisInitialized(i),c=a.value;a=function(){var a={type:"call",id:c,method:"__anonymous",thisArg:null,argList:Array.from(arguments)};return b.callMessageHandler(a)};i.$WorkerFuncChannel2.set(c,new p(a));return a}},custom:{serialize:function(a,b){var c=a.constructor.name,d=i.$WorkerFuncChannel4[c];d!=null||h(0,63779,c);d=d.serialize(a,b);return{type:"custom",custom:c,value:d}},deserialize:function(a){var b=a.custom,c=i.$WorkerFuncChannel4[b];c!=null||h(0,63779,b);return c.deserialize(a.value)}},error:{serialize:function(a,b){b={name:a.name,message:a.message,stack:a.stack};return{type:"error",value:b}},deserialize:function(a){var b=c("err")(a.value.message);b.name=a.value.name;b.stack=a.value.stack;return b}},object:{serialize:function(a,b){b=a.constructor;if(b!==Object)throw new Error("Cannot clone class object");return{type:"object",value:a}},deserialize:function(a){return a.value}},raw:{serialize:function(a,b){return{type:"raw",value:a}},deserialize:function(a){return a.value}}};i.name=b;i.$WorkerFuncChannel3=f;i.$WorkerFuncChannel4=g;a=function(a){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("adsworker").debug("[Channel] removing callback ids: %s",a.join()),a.forEach(function(a){return i.$WorkerFuncChannel1["delete"](a)})};var k=i.__remoteInternalFunc(m,a);typeof jest===typeof void 0&&(j||(j=c("ExecutionEnvironment"))).isInBrowser&&setInterval(function(){var a=[];i.$WorkerFuncChannel2.forEach(function(b,c){b.isDead()&&(a.push(c),i.$WorkerFuncChannel2["delete"](c))});a.length>0?k(a):i.$WorkerFuncChannel2.size>5e3&&c("FBLogger")("adsworker").warn("[%s] has too many remaining refs %s",i.name,i.$WorkerFuncChannel2.size)},l);return i}var f=a.prototype;f.__remoteInternalFunc=function(a,b){(a>n||this.$WorkerFuncChannel1.get(a)!=null)&&c("FBLogger")("adsworker").mustfix("invalid internal func id %s",a);this.$WorkerFuncChannel1.set(a,b);b=this.$WorkerFuncChannel5["function"].deserialize({type:"function",value:a});return b};f.$WorkerFuncChannel6=function(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array};f.$WorkerFuncChannel7=function(a){if(typeof a==="function")return"function";if(a===null)return"raw";if(typeof a!=="object")return"raw";if(Array.isArray(a))return"raw";if(this.$WorkerFuncChannel6(a))return"raw";var b=a.constructor.name;if(this.$WorkerFuncChannel4[b])return"custom";return a instanceof Error?"error":"object"};f.$WorkerFuncChannel8=function(a,b){var c=this.$WorkerFuncChannel7(a);return this.$WorkerFuncChannel5[c].serialize(a,b)};f.$WorkerFuncChannel9=function(a){var b=a;if(a!==null&&typeof a==="object"&&typeof a.type==="string"){var c=this.$WorkerFuncChannel5[a.type];if(c)return c.deserialize(a)}return b};f.__onPostOutMessage=function(a){return a};f.__callCallback=function(a,b){a.apply(null,b.argList)};f.setOutMessagePort=function(a,d){var e=this,f=[];this.setCallMessageHandler(function(d){d.thisArg=e.name;var g=[];d.argList=d.argList.map(function(a){return e.$WorkerFuncChannel8(a,g)});var h=new(i||(i=b("Promise")))(function(a,b){d.result={resolveFunc:e.$WorkerFuncChannel8(a,g),rejectFunc:e.$WorkerFuncChannel8(b,g)}}),j=e.__onPostOutMessage(d);j!=null&&(f!=null?f.push({message:d,transferList:g}):a.postMessage(d,g));h["catch"](function(a){c("FBLogger")("worker").catching(a).mustfix("Error: channel %s, remote call of %s returned error %s",e.name,d.method,a.message)});return h});c("promiseDone")(d||x.waitForRemote(this.name),function(){var b=f;f=null;b==null?void 0:b.forEach(function(b){a.postMessage(b.message,b.transferList)});e.$WorkerFuncChannel3==null?void 0:e.$WorkerFuncChannel3()})};f.__messageToCall=function(a){var b=this;a.argList=a.argList.map(function(a){return b.$WorkerFuncChannel9(a)});if(a.result){var d=a.result,e=d.resolveFunc;d=d.rejectFunc;e=this.$WorkerFuncChannel9(e);d=this.$WorkerFuncChannel9(d);a.result={resolveFunc:e,rejectFunc:d}}e=a.id;if(e===void 0)this.messageToCall(a);else{d=this.$WorkerFuncChannel1.get(e);d?this.__callCallback(d,a):c("FBLogger")("adsworker").mustfix("Error: callback is called but no longer available")}};f.setInMessagePort=function(a){var b=this;a.addMessageListener("call",function(a){typeof a.thisArg==="string"&&a.thisArg===b.name&&b.__messageToCall(a)});x.notifyReady(this.name)};f.setMessagePort=function(a){this.setInMessagePort(a);this.setOutMessagePort(a);return this};return a}(c("FuncChannel")),r=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("WorkerMessagePort").WorkerMessagePort);function s(a,b,d,e){x.exportChannel(a,function(e){var f=e.syncPort;e=e.remoteNativePort;var g=b();a===g.name||h(0,54247,a,g.name);var i;e?(i=new r(e,f.name+"("+g.name+")"),e.start(),i.onError.add(function(a){c("FBLogger")("worker").catching(a).mustfix("error caught in remotePort");throw a})):i=f;g.setMessagePort(i).setBackend(d);c("promiseDone")(f.fullyConnected,function(){f.postMessage({type:"channelReady",channelName:g.name}),x.logState("EXPORTED",a)})})}function a(a,b,c,d){d===void 0&&(d={});return s(c,function(){return new q(function(b){return a},c,null,d)},a,b)}var t=function(b){babelHelpers.inheritsLoose(a,b);function a(a,e){e===void 0&&(e="");var f=d("DateConsts").MS_PER_MIN*1;return b.call(this,function(){c("FBLogger")("worker").warn("Channel %s did not establish eventually. %s",a,e)},f)||this}return a}(d("TimedOnceFunc").TimedOnceFunc);function u(a,b){var e,f=null,g,h;b.isWrappingVirtualMessagePort()?(h=new(d("VirtualMessageChannel").VirtualMessageChannel)(!0,!0),e="on virtual dedicated channel"):(h=new MessageChannel(),e="on native dedicated channel",g=[h.port2]);var i=h.port1;f=h.port2;i.start();var j=new r(i,b.name+"("+a.name+")");c("promiseDone")(b.fullyConnected,function(){x.logState("IMPORTING "+e+" ",a.name);a.setInMessagePort(j);var d=new t(a.name,e);c("promiseDone")(b.onMessageOnce("channelReady",function(b){return b.channelName===a.name}),function(b){a.setOutMessagePort(j),d.cancel(),x.logState("ESTABLISHED",a.name)});b.postMessage({type:"channelImport",channelName:a.name,port:f},g)});return a.proxyMethods}function v(a,b,c,d){c===void 0&&(c=null);d===void 0&&(d={});b=new q(function(b){return a},b,c,d);return b}function e(a,b,c,d,e){d===void 0&&(d=null);e===void 0&&(e={});return u(v(a,c,d,e),b)}var w=function(){function a(){this.name=self.name+"_P"+Math.round(10*Math.random()),this.$1=new Map(),this.$2=new Set()}var e=a.prototype;e.logState=function(a,b){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("worker").debug("%s-%s %s",this.name,a,b)};e.$3=function(a){var b=this.$1.get(a);b==null&&(b={pendingPorts:null,onImportRequest:null},this.$1.set(a,b));return b};e.exportChannel=function(a,b){var d=this,e=this.$3(a);e.onImportRequest!=null&&c("FBLogger")("worker").debug("Re-exporting channel %s",a);e.onImportRequest=b;this.logState("REGISTERED",a);a=e.pendingPorts;if(a!=null){var f=a.filter(function(a){return d.$2.has(a.syncPort)});f.forEach(b);f.length<a.length?e.pendingPorts=a.filter(function(a){return!d.$2.has(a.syncPort)}):e.pendingPorts=null}return e};e.activate=function(a,b,d){var e=this;if(this.$2.has(a)){c("FBLogger")("worker").debug("Port %sis already duplicated ",a.name);return}this.$2.add(a);a.addMessageListener("channelImport",function(b){var c=b.channelName,d=e.$3(c);b={syncPort:a,remoteNativePort:b.port};d.onImportRequest!=null?d.onImportRequest(b):d.pendingPorts!=null?d.pendingPorts.push(b):d.pendingPorts=[b];e.logState("IMPORT REQUEST",c)})};e.notifyReady=function(a){};e.waitForRemote=function(a){return(i||(i=b("Promise"))).resolve()};return a}(),x=new w();function f(a,b,c){x.activate(a,b,c)}g.TransferableTransformer=k;g.WorkerFuncChannel=q;g.exportChannelOnPort=s;g.exportChannel=a;g.importChannelOnPort=u;g.makeChannel=v;g.importChannel=e;g.activateChannels=f}),98);
__d("WorkerQPLChannel",["WorkerFuncChannel","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WorkerFuncChannel").WorkerFuncChannel)(function(a){return{markerStartFromNavStart:null,markerStart:function(b,d,e){e===void 0&&(e=(h||(h=c("performanceAbsoluteNow")))());return a.markerStart(b,d,e)},markerAnnotate:function(b,c,d){return a.markerAnnotate(b,c,d)},markerPoint:function(b,d,e){e=(e==null?void 0:e.timestamp)===void 0?babelHelpers["extends"]({},e,{timestamp:(h||(h=c("performanceAbsoluteNow")))()}):e;return a.markerPoint(b,d,e)},markerEnd:function(b,d,e,f){f===void 0&&(f=(h||(h=c("performanceAbsoluteNow")))());return a.markerEnd(b,d,e,f)}}},"qpl");function a(a){i.setMessagePort(a)}function b(a){i.setBackend(a)}g.setMessagePort=a;g.initQPL=b}),98);